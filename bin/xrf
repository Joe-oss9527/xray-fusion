#!/usr/bin/env bash
set -euo pipefail
SCRIPT_PATH="$(readlink -f "${BASH_SOURCE[0]}")"
HERE="$(cd "$(dirname "${SCRIPT_PATH}")/.." && pwd)"
. "${HERE}/lib/core.sh"
usage() {
  cat << EOF
xrf â€” Xray Fusion Lite (complete clean)
Usage: xrf <command>
  install     Install Xray & deploy confdir (atomic, flock-protected)
  status      Show version & active confdir
  uninstall   Remove Xray (keep state)
  links       Print client links
  logs        View, filter, and export Xray logs
  backup      Manage configuration backups
  test-sni    Test SNI domain for REALITY protocol compatibility
  health      Run post-installation health check
  templates   Manage configuration templates
  plugin      Manage plugins (list/enable/disable/info)
  help        Show this help
EOF
}
case "${1-}" in
  install)
    shift || true
    "${HERE}/commands/install.sh" "$@"
    ;;
  status)
    shift || true
    "${HERE}/commands/status.sh" "$@"
    ;;
  uninstall)
    shift || true
    "${HERE}/commands/uninstall.sh" "$@"
    ;;
  links)
    shift || true
    "${HERE}/services/xray/client-links.sh" "$@"
    ;;
  logs)
    shift || true
    "${HERE}/commands/logs.sh" "$@"
    ;;
  backup)
    shift || true
    "${HERE}/commands/backup.sh" "$@"
    ;;
  test-sni)
    shift || true
    "${HERE}/commands/test-sni.sh" "$@"
    ;;
  health)
    shift || true
    "${HERE}/commands/health.sh" "$@"
    ;;
  templates)
    shift || true
    "${HERE}/commands/templates.sh" "$@"
    ;;
  plugin)
    shift || true
    "${HERE}/commands/plugin.sh" "$@"
    ;;
  help | "") usage ;;
  *)
    usage
    exit 2
    ;;
esac
