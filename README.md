```
 â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
 â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•      â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
  â•šâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
 â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
 â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•   â•šâ•â•         â•šâ•â•      â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
```

# xray-fusion-lite (complete, clean, pluginized)

**ç›®æ ‡**ï¼šæç®€ã€å¯ç»´æŠ¤ã€å¯è§‚æµ‹ã€‚æ ¸å¿ƒä»…è´Ÿè´£ï¼šå®‰è£… Xray â†’ æ¸²æŸ“åˆ†ç‰‡é…ç½®ï¼ˆ`-confdir`ï¼‰â†’ åŸå­åˆ‡æ¢ `active` â†’ systemd å•å…ƒã€‚å…¶ä½™å…¨éƒ¨æ’ä»¶åŒ–ï¼ˆè¯ä¹¦ / é˜²ç«å¢™ / é“¾æ¥äºŒç»´ç  / æ—¥å¿—è½®è½¬ï¼‰ã€‚

## ğŸš€ ä¸€é”®å®‰è£…

### åŸºç¡€å®‰è£…
```bash
# Reality-only æ‹“æ‰‘ï¼Œé»˜è®¤ç«¯å£ 443ï¼Œè‡ªåŠ¨ç”Ÿæˆé…ç½®
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash
```

### è‡ªå®šä¹‰åŸŸåå’Œç«¯å£å®‰è£…
```bash
# ä½¿ç”¨è‡ªå®šä¹‰åŸŸåå’Œç«¯å£
XRAY_SNI=your.domain.com XRAY_PORT=8443 \
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash

```

### é«˜çº§å®‰è£…
```bash
# Vision + Reality æ‹“æ‰‘ï¼Œå¯ç”¨è¯ä¹¦å’Œæ—¥å¿—æ’ä»¶
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash -s -- \
  --topology vision-reality \
  --enable-plugins cert-auto,logrotate-obs
```

### å®‰è£…é€‰é¡¹
- `--topology reality-only|vision-reality` - é€‰æ‹©æ‹“æ‰‘ç±»å‹
- `--version <version>` - æŒ‡å®š Xray ç‰ˆæœ¬ï¼ˆé»˜è®¤ï¼šlatestï¼‰
- `--enable-plugins <plugin1,plugin2>` - å¯ç”¨æ’ä»¶
- `--proxy <proxy_url>` - ä½¿ç”¨ä»£ç†ä¸‹è½½
- `--install-dir <path>` - è‡ªå®šä¹‰å®‰è£…ç›®å½•
- `--debug` - å¯ç”¨è°ƒè¯•è¾“å‡º

## ğŸ—‘ï¸ ä¸€é”®å¸è½½

### å®Œå…¨å¸è½½
```bash
# æ ‡å‡†å¸è½½ï¼ˆä¿ç•™å®‰è£…ç›®å½•ï¼‰
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash

# å½»åº•å¸è½½ï¼ˆåŒ…æ‹¬å®‰è£…ç›®å½•ï¼‰
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash -s -- --remove-install-dir
```

### ä¿ç•™é…ç½®å¸è½½
```bash
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash -s -- --keep-config
```

### å¸è½½é€‰é¡¹
- `--keep-config` - ä¿ç•™é…ç½®æ–‡ä»¶
- `--remove-install-dir` - ç§»é™¤å®‰è£…ç›®å½•ï¼ˆå½»åº•æ¸…ç†ï¼‰
- `--force` - å¼ºåˆ¶å¸è½½æ— éœ€ç¡®è®¤ï¼ˆéäº¤äº’æ¨¡å¼è‡ªåŠ¨å¯ç”¨ï¼‰
- `--debug` - å¯ç”¨è°ƒè¯•è¾“å‡º

## å¿«é€Ÿå¼€å§‹ï¼ˆæ‰‹åŠ¨å®‰è£…ï¼‰

```bash
# 1) å®‰è£…ï¼ˆReality-onlyï¼›ç«¯å£é»˜è®¤ 443ï¼›è‡ªåŠ¨ç”Ÿæˆ uuid/shortId/å¯†é’¥ï¼‰
bin/xrf install --topology reality-only

# 2) å¯¼å‡ºå®¢æˆ·ç«¯é“¾æ¥ï¼ˆæ’ä»¶å¯æ‰©å±• QRã€è§‚æµ‹æç¤ºç­‰ï¼‰
bin/xrf links
```

### Vision + Realityï¼ˆå¸¦è¯ä¹¦ï¼‰
```bash
XRAY_DOMAIN="your.domain.com" ./install.sh --topology vision-reality --enable-plugins cert-auto
```

### æ–‡ä»¶æ—¥å¿— + logrotateï¼ˆæ¨èç”Ÿäº§ï¼‰
```bash
bin/xrf plugin enable logrotate-obs
XRF_LOG_TARGET=file bin/xrf install --topology reality-only
# /var/log/xray/{error.log,access.log}ï¼›/etc/logrotate.d/xray-fusion
```

## ç›®å½•ç»“æ„
```
bin/xrf
lib/{core.sh,plugins.sh}
modules/{io.sh,state.sh,net/network.sh,fw/*,cert/*,user/user.sh}
services/xray/{common.sh,install.sh,configure.sh,systemd-unit.sh,client-links.sh}
commands/{install.sh,status.sh,uninstall.sh,plugin.sh}
packaging/systemd/xray.service
plugins/available/{cert-auto,firewall,links-qr,logrotate-obs}/plugin.sh
plugins/enabled/   # å¯ç”¨=è¿™é‡Œå»ºè½¯é“¾
```

> ä»… systemdï¼›æ—  OpenRC/CI/Tests ç­‰éè¿è¡Œæ—¶å¿…éœ€ç»„ä»¶ï¼Œ**å»å†—ä½™**ã€**é™å¤æ‚åº¦**ã€‚é…ç½®ç‰‡æ®µåˆå¹¶éµå¾ª Xray å®˜æ–¹è¯­ä¹‰ï¼šå¯¹è±¡â€œåè¯»è¦†ç›–â€ã€æ•°ç»„â€œåè¯»è¿½åŠ â€ã€‚Reality å¼ºåˆ¶ `flow: "xtls-rprx-vision"`ã€‚

## ç¯å¢ƒå˜é‡é…ç½®

### Xray é…ç½®å˜é‡
```bash
# Reality-only æ‹“æ‰‘
export XRAY_PORT=443                    # ç›‘å¬ç«¯å£
export XRAY_UUID=<uuid>                 # ç”¨æˆ· UUIDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
export XRAY_SNI=www.microsoft.com       # SNI åŸŸå
export XRAY_REALITY_DEST=www.microsoft.com:443  # ç›®æ ‡åœ°å€
export XRAY_PRIVATE_KEY=<X25519>        # ç§é’¥ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
export XRAY_SHORT_ID=<hex>              # Short IDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

# Vision + Reality æ‹“æ‰‘
export XRAY_VISION_PORT=8443            # Vision ç«¯å£
export XRAY_REALITY_PORT=443            # Reality ç«¯å£
export XRAY_FALLBACK_PORT=8080          # å›è½ç«¯å£
export XRAY_UUID_VISION=<uuid>          # Vision UUID
export XRAY_UUID_REALITY=<uuid>         # Reality UUID
export XRAY_DOMAIN=example.com          # åŸŸå
export XRAY_CERT_DIR=/usr/local/etc/xray/certs  # è¯ä¹¦ç›®å½•

# å…¶ä»–é…ç½®
export XRAY_SNIFFING=false              # å¯ç”¨å—…æ¢
export XRF_LOG_TARGET=file              # æ—¥å¿—ç›®æ ‡ (file|journal)
```

### å®‰è£…è„šæœ¬å˜é‡
```bash
export XRF_REPO_URL=https://github.com/Joe-oss9527/xray-fusion.git  # ä»“åº“åœ°å€
export XRF_BRANCH=main                  # åˆ†æ”¯
export XRF_INSTALL_DIR=/usr/local/xray-fusion  # å®‰è£…ç›®å½•
```

## å¸¸è§é—®é¢˜

### å®‰è£…å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
1. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™
2. ä½¿ç”¨ä»£ç†ï¼š`--proxy http://127.0.0.1:1080`
3. å¯ç”¨è°ƒè¯•ï¼š`--debug` æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
4. æ‰‹åŠ¨ä¸‹è½½é¡¹ç›®åæœ¬åœ°å®‰è£…

### å¦‚ä½•è‡ªå®šä¹‰åŸŸåï¼Ÿ
```bash
XRAY_SNI=your.domain.com curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash
```

### å¸è½½ä¸å¹²å‡€æ€ä¹ˆåŠï¼Ÿ
```bash
# ä½¿ç”¨å½»åº•å¸è½½é€‰é¡¹
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash -s -- --remove-install-dir --debug
```

### å¦‚ä½•æ›´æ–°ï¼Ÿ
```bash
# é‡æ–°è¿è¡Œå®‰è£…è„šæœ¬å³å¯
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash
```

### å¦‚ä½•å¤‡ä»½é…ç½®ï¼Ÿ
```bash
# å¤‡ä»½çŠ¶æ€å’Œé…ç½®
sudo cp -r /usr/local/etc/xray /backup/
sudo cp /usr/local/xray-fusion/state.json /backup/
```

## Lint & æ ¼å¼åŒ–
```bash
make fmt   # éœ€è¦ shfmt
make lint  # éœ€è¦ shellcheck
```
