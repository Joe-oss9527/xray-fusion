```
 â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
 â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•      â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
  â•šâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
 â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
 â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•   â•šâ•â•         â•šâ•â•      â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
```

# xray-fusion-lite (complete, clean, pluginized)

**ç›®æ ‡**ï¼šæç®€ã€å¯ç»´æŠ¤ã€å¯è§‚æµ‹ã€‚æ ¸å¿ƒä»…è´Ÿè´£ï¼šå®‰è£… Xray â†’ æ¸²æŸ“åˆ†ç‰‡é…ç½®ï¼ˆ`-confdir`ï¼‰â†’ åŸå­åˆ‡æ¢ `active` â†’ systemd å•å…ƒã€‚å…¶ä½™å…¨éƒ¨æ’ä»¶åŒ–ï¼ˆè¯ä¹¦ / é˜²ç«å¢™ / é“¾æ¥äºŒç»´ç  / æ—¥å¿—è½®è½¬ï¼‰ã€‚

## ğŸš€ ä¸€é”®å®‰è£…

### åŸºç¡€å®‰è£…
```bash
# Reality-only æ‹“æ‰‘ï¼Œé»˜è®¤ç«¯å£ 443ï¼Œè‡ªåŠ¨ç”Ÿæˆé…ç½®
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash
```

### è‡ªå®šä¹‰ SNI åŸŸåå®‰è£…
```bash
# Reality-only æ‹“æ‰‘ï¼Œè‡ªå®šä¹‰ SNI ä¼ªè£…åŸŸå
XRAY_SNI=your.domain.com \
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash
```

### é«˜çº§å®‰è£…
```bash
# Vision + Reality æ‹“æ‰‘ï¼Œå¯ç”¨è¯ä¹¦å’Œæ—¥å¿—æ’ä»¶
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash -s -- \
  --topology vision-reality \
  --enable-plugins cert-auto,logrotate-obs
```

### å®‰è£…é€‰é¡¹
- `--topology reality-only|vision-reality` - é€‰æ‹©æ‹“æ‰‘ç±»å‹
- `--version <version>` - æŒ‡å®š Xray ç‰ˆæœ¬ï¼ˆé»˜è®¤ï¼šlatestï¼‰
- `--enable-plugins <plugin1,plugin2>` - å¯ç”¨æ’ä»¶
- `--proxy <proxy_url>` - ä½¿ç”¨ä»£ç†ä¸‹è½½
- `--install-dir <path>` - è‡ªå®šä¹‰å®‰è£…ç›®å½•
- `--debug` - å¯ç”¨è°ƒè¯•è¾“å‡º

## ğŸ—‘ï¸ ä¸€é”®å¸è½½

### å®Œå…¨å¸è½½
```bash
# æ ‡å‡†å¸è½½ï¼ˆä¿ç•™å®‰è£…ç›®å½•ï¼‰
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash

# å½»åº•å¸è½½ï¼ˆåŒ…æ‹¬å®‰è£…ç›®å½•ï¼‰
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash -s -- --remove-install-dir
```

### ä¿ç•™é…ç½®å¸è½½
```bash
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash -s -- --keep-config
```

### å¸è½½é€‰é¡¹
- `--keep-config` - ä¿ç•™é…ç½®æ–‡ä»¶
- `--remove-install-dir` - ç§»é™¤å®‰è£…ç›®å½•ï¼ˆå½»åº•æ¸…ç†ï¼‰
- `--force` - å¼ºåˆ¶å¸è½½æ— éœ€ç¡®è®¤ï¼ˆéäº¤äº’æ¨¡å¼è‡ªåŠ¨å¯ç”¨ï¼‰
- `--debug` - å¯ç”¨è°ƒè¯•è¾“å‡º

## å¿«é€Ÿå¼€å§‹ï¼ˆæ‰‹åŠ¨å®‰è£…ï¼‰

```bash
# 1) å®‰è£…ï¼ˆReality-onlyï¼›ç«¯å£é»˜è®¤ 443ï¼›è‡ªåŠ¨ç”Ÿæˆ uuid/shortId/å¯†é’¥ï¼‰
bin/xrf install --topology reality-only

# 2) å¯¼å‡ºå®¢æˆ·ç«¯é“¾æ¥ï¼ˆæ’ä»¶å¯æ‰©å±• QRã€è§‚æµ‹æç¤ºç­‰ï¼‰
bin/xrf links
```

## æ‹“æ‰‘è¯´æ˜

### Reality-only æ‹“æ‰‘
- **ç”¨é€”**ï¼šéšè”½æ€§æœ€å¼ºï¼Œæ— éœ€åŸŸåæ‰€æœ‰æƒ
- **ç«¯å£**ï¼š443ï¼ˆæ ‡å‡† HTTPS ç«¯å£ï¼‰
- **ç‰¹ç‚¹**ï¼šSNI ä¼ªè£…ï¼Œæµé‡ç‰¹å¾ä¸ç›®æ ‡ç½‘ç«™ç›¸åŒ

### Vision-Reality æ‹“æ‰‘
- **ç”¨é€”**ï¼šåŒé‡ä¿æŠ¤ï¼ŒVision æä¾›åŸŸå TLSï¼ŒReality æä¾›å¤‡ç”¨è¿æ¥
- **ç«¯å£**ï¼šVision 8443ï¼ŒReality 443
- **ç‰¹ç‚¹**ï¼šéœ€è¦åŸŸåæ‰€æœ‰æƒï¼Œè‡ªåŠ¨è¯ä¹¦ç®¡ç†

```bash
# Vision + Reality æ‹“æ‰‘ç¤ºä¾‹
XRAY_DOMAIN="your.domain.com" \
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash -s -- \
  --topology vision-reality --enable-plugins cert-auto
```

### å¯ç”¨æ—¥å¿—è½®è½¬ï¼ˆæ¨èç”Ÿäº§ï¼‰
```bash
# å¯ç”¨æ–‡ä»¶æ—¥å¿—å’Œè‡ªåŠ¨è½®è½¬
bin/xrf plugin enable logrotate-obs
XRF_LOG_TARGET=file bin/xrf install --topology reality-only
```

## ç›®å½•ç»“æ„
```
bin/xrf
lib/{core.sh,plugins.sh}
modules/{io.sh,state.sh,net/network.sh,fw/*,web/caddy.sh,user/user.sh}
services/xray/{common.sh,install.sh,configure.sh,systemd-unit.sh,client-links.sh}
commands/{install.sh,status.sh,uninstall.sh,plugin.sh}
packaging/systemd/xray.service
plugins/available/{cert-auto,firewall,links-qr,logrotate-obs}/plugin.sh
plugins/enabled/   # å¯ç”¨=è¿™é‡Œå»ºè½¯é“¾
```

> **æ¶æ„åŸåˆ™**ï¼šä»… systemdï¼›æ—  OpenRC/CI/Tests ç­‰éè¿è¡Œæ—¶å¿…éœ€ç»„ä»¶ï¼Œ**å»å†—ä½™**ã€**é™å¤æ‚åº¦**ã€‚é…ç½®ç‰‡æ®µåˆå¹¶éµå¾ª Xray å®˜æ–¹è¯­ä¹‰ï¼šå¯¹è±¡"åè¯»è¦†ç›–"ã€æ•°ç»„"åè¯»è¿½åŠ "ã€‚
>
> **é‡è¦æ¦‚å¿µ**ï¼šVLESS+REALITY åè®®**æ— éœ€åŸŸåæ‰€æœ‰æƒ**ï¼ŒSNI åŸŸåä»…ç”¨äº TLS æ¡æ‰‹ä¼ªè£…ã€‚ä¾‹å¦‚ `XRAY_SNI=www.microsoft.com` æ˜¯åˆæ³•é…ç½®ï¼Œæ— éœ€æ‹¥æœ‰è¯¥åŸŸåã€‚

## ç¯å¢ƒå˜é‡é…ç½®

### Xray é…ç½®å˜é‡
```bash
# Reality-only æ‹“æ‰‘ï¼ˆæ¨èé…ç½®ï¼‰
export XRAY_PORT=443                    # ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ 443ï¼‰
export XRAY_UUID=<uuid>                 # ç”¨æˆ· UUIDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
export XRAY_SNI=www.microsoft.com       # SNI ä¼ªè£…åŸŸåï¼ˆæ— éœ€æ‹¥æœ‰ï¼‰
export XRAY_REALITY_DEST=www.microsoft.com:443  # ç›®æ ‡åœ°å€ï¼ˆè‡ªåŠ¨æ¨å¯¼ï¼‰
export XRAY_PRIVATE_KEY=<X25519>        # ç§é’¥ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
export XRAY_SHORT_ID=<hex>              # Short IDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

# Vision-Reality æ‹“æ‰‘ï¼ˆéœ€è¦åŸŸåæ‰€æœ‰æƒï¼‰
export XRAY_VISION_PORT=8443            # Vision ç«¯å£ï¼ˆTLS çœŸå®è¿æ¥ï¼‰
export XRAY_REALITY_PORT=443            # Reality ç«¯å£ï¼ˆä¼ªè£…è¿æ¥ï¼‰
export XRAY_FALLBACK_PORT=8080          # å›è½ç«¯å£
export XRAY_UUID_VISION=<uuid>          # Vision UUIDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
export XRAY_UUID_REALITY=<uuid>         # Reality UUIDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
export XRAY_DOMAIN=example.com          # çœŸå®æ‹¥æœ‰çš„åŸŸå
export XRAY_CERT_DIR=/usr/local/etc/xray/certs  # è¯ä¹¦ç›®å½•

# é€šç”¨é…ç½®
export XRAY_SNIFFING=false              # æµé‡å—…æ¢ï¼ˆé»˜è®¤å…³é—­ï¼‰
export XRF_LOG_TARGET=journal           # æ—¥å¿—ç›®æ ‡ (journal|file)
export XRF_DEBUG=false                  # è°ƒè¯•æ¨¡å¼ï¼ˆ--debug å¯ç”¨ï¼‰
```

### å®‰è£…è„šæœ¬å˜é‡
```bash
export XRF_REPO_URL=https://github.com/Joe-oss9527/xray-fusion.git  # ä»“åº“åœ°å€
export XRF_BRANCH=main                  # åˆ†æ”¯
export XRF_INSTALL_DIR=/usr/local/xray-fusion  # å®‰è£…ç›®å½•
```

## å¸¸è§é—®é¢˜

### å¦‚ä½•é€‰æ‹©æ‹“æ‰‘ï¼Ÿ
- **Reality-only**ï¼šæ¨èï¼Œæ— éœ€åŸŸåæ‰€æœ‰æƒï¼Œéšè”½æ€§æœ€å¼º
- **Vision-Reality**ï¼šéœ€è¦åŸŸåï¼Œæä¾›åŒé‡è¿æ¥é€‰é¡¹

### å®‰è£…é—®é¢˜æ’æŸ¥
```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash -s -- --debug

# ä½¿ç”¨ä»£ç†ä¸‹è½½
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash -s -- --proxy http://127.0.0.1:1080
```

### ç®¡ç†æ“ä½œ
```bash
# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/install.sh | bash

# å½»åº•å¸è½½
curl -sL https://raw.githubusercontent.com/Joe-oss9527/xray-fusion/main/uninstall.sh | bash -s -- --remove-install-dir

# æŸ¥çœ‹è¿æ¥ä¿¡æ¯
bin/xrf links

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
bin/xrf status
```

## Lint & æ ¼å¼åŒ–
```bash
make fmt   # éœ€è¦ shfmt
make lint  # éœ€è¦ shellcheck
```
